<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MinisForum Database Control - Silver Fox Marketing</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Order Queue Tab Dealership List Fix -->
    <style>
        /* Fix for Order Queue Tab Dealership List */
        .dealership-list {
            max-height: 600px !important;
            min-height: 400px !important;
            overflow-y: auto !important;
            padding: 15px !important;
            border: 1px solid #ddd !important;
            border-radius: 8px !important;
            background: white !important;
        }
        
        .dealership-selection h3 {
            margin-bottom: 15px !important;
        }
        
        .selection-panel {
            min-width: 45% !important;
            max-width: 55% !important;
            flex: 1 !important;
        }
        
        .queue-layout {
            display: flex !important;
            gap: 20px !important;
            width: 100% !important;
        }
        
        .queue-panel {
            min-width: 40% !important;
            max-width: 50% !important;
            flex: 1 !important;
        }
        
        /* Make dealership items more readable */
        .dealership-item {
            padding: 12px !important;
            margin-bottom: 8px !important;
            border: 1px solid #eee !important;
            border-radius: 6px !important;
            font-size: 14px !important;
            line-height: 1.4 !important;
        }
        
        /* CSV test options styling */
        .csv-test-options {
            margin-top: 15px !important;
            padding: 10px !important;
            background: #f8f9fa !important;
            border-radius: 6px !important;
            border: 1px solid #dee2e6 !important;
        }
        
        .csv-test-options label {
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
            margin-bottom: 5px !important;
            font-weight: 500 !important;
        }
        
        .csv-test-options .help-text {
            color: #6c757d !important;
            font-size: 0.85rem !important;
            font-style: italic !important;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo-section">
                    <img src="{{ url_for('static', filename='images/LS_MAIN-PRIMARY.svg') }}" alt="Silver Fox Marketing" class="header-logo">
                    <div class="title-section">
                        <h1 class="app-title">MinisForum Database Control</h1>
                        <span class="company-name">Silver Fox Marketing</span>
                    </div>
                </div>
                <div class="status-section">
                    <div class="status-indicator" id="systemStatus">
                        <i class="fas fa-circle status-icon"></i>
                        <span class="status-text">System Ready</span>
                    </div>
                    <div class="last-scrape" id="lastScrape">
                        Last Scrape: Never
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Content Area - Full Width -->
            <div class="content-area">
                <!-- Tab Navigation -->
                <nav class="tab-navigation">
                    <button class="tab-button active" data-tab="scraper">
                        <i class="fas fa-spider"></i>
                        Scraper Control
                    </button>
                    <button class="tab-button" data-tab="queue-management">
                        <i class="fas fa-tasks"></i>
                        Order Queue
                    </button>
                    <button class="tab-button" data-tab="data-search">
                        <i class="fas fa-search"></i>
                        Data
                    </button>
                    <button class="tab-button" data-tab="dealership-settings">
                        <i class="fas fa-cogs"></i>
                        Dealership Settings
                    </button>
                    <button class="tab-button" data-tab="system-status">
                        <i class="fas fa-chart-line"></i>
                        System Status
                    </button>
                    <button class="tab-button" onclick="window.open('/stress-test', '_blank')">
                        <i class="fas fa-vial"></i>
                        System Tests
                    </button>
                    <button class="tab-button" onclick="window.open('/websocket-test', '_blank')" title="Test WebSocket Connection">
                        <i class="fas fa-wifi"></i>
                        WebSocket Test
                    </button>
                </nav>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Scraper Tab -->
                    <div class="tab-panel active" id="scraper-panel">
                        <div class="panel-header">
                            <h2>Scraper Control Center</h2>
                            <div class="control-buttons">
                                <button class="btn btn-secondary" id="selectDealershipsBtn">
                                    <i class="fas fa-list-check"></i>
                                    Select Dealerships
                                </button>
                                <button class="btn btn-secondary" id="scheduleBtn">
                                    <i class="fas fa-clock"></i>
                                    Schedule
                                </button>
                                <button class="btn btn-primary" id="startScrapeBtn">
                                    <i class="fas fa-play"></i>
                                    Start Scrape (All)
                                </button>
                                <button class="btn btn-secondary" id="testWebSocketBtn" title="Test WebSocket Connection">
                                    <i class="fas fa-wifi"></i>
                                    Test Connection
                                </button>
                            </div>
                        </div>
                        

                        <!-- Live Scraper Console (moved from System Status tab) -->
                        <div class="system-console">
                            <div class="console-header">
                                <h3>
                                    <i class="fas fa-terminal"></i>
                                    Live Scraper Console
                                </h3>
                                
                                <!-- Progress Indicators (new) -->
                                <div class="progress-indicators">
                                    <div class="indicator">
                                        <i class="fas fa-building"></i>
                                        <span class="indicator-value" id="dealershipsProcessed">0</span>
                                    </div>
                                    <div class="indicator">
                                        <i class="fas fa-car"></i>
                                        <span class="indicator-value" id="vehiclesProcessed">0</span>
                                    </div>
                                    <div class="indicator">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        <span class="indicator-value" id="errorsCount">0</span>
                                    </div>
                                </div>
                                
                                <div class="console-controls">
                                    <button class="terminal-clear" onclick="app.clearScraperConsole()">
                                        <i class="fas fa-broom"></i>
                                        Clear
                                    </button>
                                    <button class="terminal-clear" onclick="app.pauseScraperConsole()">
                                        <i class="fas fa-pause" id="pauseIcon"></i>
                                        <span id="pauseText">Pause</span>
                                    </button>
                                </div>
                            </div>
                            <div class="console-content" id="scraperConsoleOutput">
                                <div class="terminal-line">
                                    <span class="timestamp">[00:00:00]</span>
                                    <span class="message">Scraper console ready - waiting for scraper activity...</span>
                                </div>
                            </div>
                        </div>

                        <!-- Dealership Grid - Removed in favor of dropdown selection -->
                        <!-- <div class="dealership-grid" id="dealershipGrid">
                            Dealerships will be loaded dynamically
                        </div> -->

                        <!-- Scraper Status -->
                        <div class="scraper-status" id="scraperStatus" style="display: none;">
                            <div class="status-header">
                                <h3>Scraper Progress</h3>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progressFill"></div>
                                </div>
                            </div>
                            <div class="status-details" id="statusDetails">
                                <!-- Progress details will be shown here -->
                            </div>
                            
                            <!-- Real-time Scraper Console -->
                            <div class="scraper-console">
                                <div class="console-header">
                                    <h4>
                                        <i class="fas fa-terminal"></i>
                                        Real-time Scraper Output
                                    </h4>
                                    <button class="btn btn-secondary btn-sm" id="clearScraperConsole">
                                        <i class="fas fa-trash"></i>
                                        Clear
                                    </button>
                                </div>
                                <div class="console-content" id="scraperConsoleOutput">
                                    <div class="terminal-line">
                                        <span class="timestamp">[Ready]</span>
                                        <span class="message">Scraper console initialized</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Search Tab -->
                    <div class="tab-panel" id="data-search-panel">
                        <div class="panel-header">
                            <h2>Data Management</h2>
                            <div class="control-buttons">
                                <button class="btn btn-secondary" id="exportSearchResults" style="display: none;">
                                    <i class="fas fa-download"></i>
                                    Export Results
                                </button>
                                <button class="btn btn-primary" id="refreshDataSearch">
                                    <i class="fas fa-sync"></i>
                                    Refresh
                                </button>
                            </div>
                        </div>
                        
                        <!-- Sub-tab Navigation -->
                        <div class="sub-tab-navigation">
                            <button class="sub-tab-button active" data-subtab="vehicle-search">
                                <i class="fas fa-car"></i>
                                Vehicle Search
                            </button>
                            <button class="sub-tab-button" data-subtab="vin-history">
                                <i class="fas fa-history"></i>
                                VIN History Logs
                            </button>
                        </div>
                        
                        <!-- Sub-tab Panels -->
                        <div class="sub-tab-panels">
                            <!-- Vehicle Search Sub-panel -->
                            <div class="sub-tab-panel active" id="vehicle-search-panel">
                                <!-- Search Interface -->
                                <div class="search-interface">
                            <div class="search-controls">
                                <div class="search-bar-container">
                                    <input type="text" 
                                           class="search-input" 
                                           id="vehicleSearchInput" 
                                           placeholder="Search vehicles by VIN, make, model, stock number, or dealer...">
                                    <button class="search-btn" id="searchVehiclesBtn">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                                
                                <div class="filter-controls">
                                    <!-- Filter by dropdown -->
                                    <div class="filter-group">
                                        <label for="filterBy">Show by:</label>
                                        <select id="filterBy" class="filter-select">
                                            <option value="all">All Records</option>
                                            <option value="date">By Date Range</option>
                                            <option value="dealer">By Dealer</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Date range inputs (hidden by default) -->
                                    <div class="filter-group date-filter" id="dateFilter" style="display: none;">
                                        <label for="startDate">From:</label>
                                        <input type="date" id="startDate" class="date-input">
                                        <label for="endDate">To:</label>
                                        <input type="date" id="endDate" class="date-input">
                                    </div>
                                    
                                    <!-- Dealer selection (hidden by default) -->
                                    <div class="filter-group dealer-filter" id="dealerFilter" style="display: none;">
                                        <label for="dealerSelect">Dealer:</label>
                                        <select id="dealerSelect" class="filter-select">
                                            <option value="">Select Dealer...</option>
                                        </select>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <!-- Search Results -->
                            <div class="search-results" id="searchResults">
                                <div class="results-header" id="resultsHeader" style="display: none;">
                                    <div class="results-count">
                                        <span id="resultsCount">0</span> vehicles found
                                    </div>
                                    <div class="sort-controls">
                                        <label for="sortBy">Sort by:</label>
                                        <select id="sortBy" class="sort-select">
                                            <option value="import_timestamp">Date Added</option>
                                            <option value="price">Price</option>
                                            <option value="year">Year</option>
                                            <option value="make">Make</option>
                                            <option value="model">Model</option>
                                            <option value="mileage">Mileage</option>
                                        </select>
                                        <select id="sortOrder" class="sort-select">
                                            <option value="desc">Descending</option>
                                            <option value="asc">Ascending</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="results-table-container" id="resultsTableContainer">
                                    <div class="initial-message">
                                        <i class="fas fa-search"></i>
                                        <h3>Vehicle Data Search</h3>
                                        <p>Search through all vehicle inventory data from your dealership scrapers</p>
                                        <ul class="search-features">
                                            <li>Full-text search across all fields</li>
                                            <li>Filter by date range or specific dealers</li>
                                            <li>View raw scraped data or normalized records</li>
                                            <li>Export results to CSV</li>
                                        </ul>
                                        <p class="help-text">Start typing in the search box above to find vehicles</p>
                                    </div>
                                </div>
                                
                                <!-- Pagination -->
                                <div class="pagination" id="paginationControls" style="display: none;">
                                    <button class="btn btn-secondary" id="prevPageBtn" disabled>
                                        <i class="fas fa-chevron-left"></i>
                                        Previous
                                    </button>
                                    <span class="page-info" id="pageInfo">Page 1 of 1</span>
                                    <button class="btn btn-secondary" id="nextPageBtn" disabled>
                                        Next
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                            </div>
                            
                            <!-- VIN History Sub-panel -->
                            <div class="sub-tab-panel" id="vin-history-panel" style="display: none;">
                                <div class="vin-history-interface">
                                    <!-- VIN History Header with Stats -->
                                    <div class="vin-history-stats">
                                        <div class="stat-card">
                                            <div class="stat-value" id="totalVins">0</div>
                                            <div class="stat-label">Total VINs</div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-value" id="uniqueVins">0</div>
                                            <div class="stat-label">Unique VINs</div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-value" id="totalDealerships">0</div>
                                            <div class="stat-label">Dealerships</div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-value" id="dateRange">--</div>
                                            <div class="stat-label">Date Range</div>
                                        </div>
                                    </div>
                                    
                                    <!-- VIN History Search Controls -->
                                    <div class="vin-history-controls">
                                        <div class="search-bar-container">
                                            <input type="text" 
                                                   class="search-input" 
                                                   id="vinHistorySearchInput" 
                                                   placeholder="Search by VIN or dealership name...">
                                            <button class="search-btn" id="searchVinHistoryBtn">
                                                <i class="fas fa-search"></i>
                                            </button>
                                        </div>
                                        
                                        <div class="filter-controls">
                                            <div class="filter-group">
                                                <label for="vinHistoryDealerFilter">Dealership:</label>
                                                <select id="vinHistoryDealerFilter" class="filter-select">
                                                    <option value="">All Dealerships</option>
                                                </select>
                                            </div>
                                            
                                            <div class="filter-group">
                                                <label for="vinHistoryDateFrom">From:</label>
                                                <input type="date" id="vinHistoryDateFrom" class="date-input">
                                            </div>
                                            
                                            <div class="filter-group">
                                                <label for="vinHistoryDateTo">To:</label>
                                                <input type="date" id="vinHistoryDateTo" class="date-input">
                                            </div>
                                            
                                            <button class="btn btn-secondary" id="clearVinHistoryFilters">
                                                <i class="fas fa-times"></i>
                                                Clear Filters
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- VIN History Results -->
                                    <div class="vin-history-results">
                                        <div class="results-header" id="vinHistoryResultsHeader">
                                            <div class="results-count">
                                                <span id="vinHistoryResultsCount">0</span> records found
                                            </div>
                                            <button class="btn btn-secondary" id="exportVinHistory">
                                                <i class="fas fa-download"></i>
                                                Export VIN History
                                            </button>
                                        </div>
                                        
                                        <div class="vin-history-table-container" id="vinHistoryTableContainer">
                                            <div class="initial-message">
                                                <i class="fas fa-history"></i>
                                                <h3>VIN History Database</h3>
                                                <p>View historical VIN data used for determining which vehicles need graphics</p>
                                                <ul class="search-features">
                                                    <li>28,289+ VINs across 36 dealerships</li>
                                                    <li>Cross-dealership tracking capabilities</li>
                                                    <li>Read-only access for data integrity</li>
                                                    <li>Export historical data for analysis</li>
                                                </ul>
                                                <p class="help-text">This data is critical for order processing decisions</p>
                                            </div>
                                        </div>
                                        
                                        <!-- Pagination -->
                                        <div class="pagination" id="vinHistoryPagination" style="display: none;">
                                            <button class="btn btn-secondary" id="vinHistoryPrevBtn" disabled>
                                                <i class="fas fa-chevron-left"></i>
                                                Previous
                                            </button>
                                            <span class="page-info" id="vinHistoryPageInfo">Page 1 of 1</span>
                                            <button class="btn btn-secondary" id="vinHistoryNextBtn" disabled>
                                                Next
                                                <i class="fas fa-chevron-right"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Dealership Settings Tab -->
                    <div class="tab-panel" id="dealership-settings-panel">
                        <div class="panel-header">
                            <h2>Dealership Settings</h2>
                            <div class="control-buttons">
                                <button class="btn btn-primary" id="saveAllSettingsBtn">
                                    <i class="fas fa-save"></i>
                                    Save All Changes
                                </button>
                            </div>
                        </div>

                        <!-- Search and Filter Section -->
                        <div class="dealership-settings-controls">
                            <div class="search-container">
                                <i class="fas fa-search"></i>
                                <input type="text" id="dealershipSearchInput" placeholder="Search dealerships..." class="form-control">
                            </div>
                            <div class="filter-buttons">
                                <button class="filter-btn active" data-filter="all">All (36)</button>
                                <button class="filter-btn" data-filter="new">New Only</button>
                                <button class="filter-btn" data-filter="used">Used Only</button>
                                <button class="filter-btn" data-filter="both">New & Used</button>
                            </div>
                        </div>

                        <!-- Dealership Settings Grid -->
                        <div class="dealership-settings-grid" id="dealershipSettingsGrid">
                            <div class="loading-spinner">
                                <i class="fas fa-spinner fa-spin"></i>
                                Loading dealership settings...
                            </div>
                        </div>

                        <!-- Bulk Actions -->
                        <div class="bulk-actions">
                            <h3>Bulk Actions</h3>
                            <div class="bulk-buttons">
                                <button class="btn btn-secondary" onclick="app.bulkUpdateSettings('new')">
                                    <i class="fas fa-check-square"></i>
                                    Set All to New Only
                                </button>
                                <button class="btn btn-secondary" onclick="app.bulkUpdateSettings('used')">
                                    <i class="fas fa-check-square"></i>
                                    Set All to Used Only
                                </button>
                                <button class="btn btn-secondary" onclick="app.bulkUpdateSettings('both')">
                                    <i class="fas fa-check-square"></i>
                                    Set All to New & Used
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- System Status Tab -->
                    <div class="tab-panel" id="system-status-panel">
                        <div class="panel-header">
                            <h2>Silver Fox System Status</h2>
                            <div class="control-buttons">
                                <button class="btn btn-secondary" onclick="window.open('/test', '_blank')">
                                    <i class="fas fa-external-link-alt"></i>
                                    Detailed Status
                                </button>
                                <button class="btn btn-primary" id="refreshSystemStatus">
                                    <i class="fas fa-sync"></i>
                                    Refresh
                                </button>
                            </div>
                        </div>
                        
                        <div class="system-metrics" id="systemMetrics">
                            <div class="metrics-grid">
                                <div class="metric-card">
                                    <div class="metric-icon">
                                        <i class="fas fa-spider"></i>
                                    </div>
                                    <div class="metric-content">
                                        <h3>Active Scrapers</h3>
                                        <div class="metric-value" id="activeScrapers">Loading...</div>
                                        <div class="metric-label">Real-time scrapers ready</div>
                                    </div>
                                </div>
                                
                                <div class="metric-card">
                                    <div class="metric-icon">
                                        <i class="fas fa-database"></i>
                                    </div>
                                    <div class="metric-content">
                                        <h3>Database Health</h3>
                                        <div class="metric-value" id="databaseHealth">Loading...</div>
                                        <div class="metric-label">Connection performance</div>
                                    </div>
                                </div>
                                
                                <div class="metric-card">
                                    <div class="metric-icon">
                                        <i class="fas fa-clipboard-list"></i>
                                    </div>
                                    <div class="metric-content">
                                        <h3>Order Processing</h3>
                                        <div class="metric-value" id="orderProcessingStatus">Loading...</div>
                                        <div class="metric-label">CAO & List orders ready</div>
                                    </div>
                                </div>
                                
                                <div class="metric-card">
                                    <div class="metric-icon">
                                        <i class="fas fa-car"></i>
                                    </div>
                                    <div class="metric-content">
                                        <h3>Vehicle Inventory</h3>
                                        <div class="metric-value" id="vehicleCount">Loading...</div>
                                        <div class="metric-label">Total vehicles in database</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="system-actions">
                                <h3>Quick Actions</h3>
                                <div class="action-buttons">
                                    <button class="btn btn-primary" onclick="app.switchTab('queue-management')">
                                        <i class="fas fa-tasks"></i>
                                        Open Queue Manager
                                    </button>
                                    <button class="btn btn-secondary" onclick="window.open('/stress-test', '_blank')">
                                        <i class="fas fa-vial"></i>
                                        Run System Tests
                                    </button>
                                    <button class="btn btn-secondary" id="exportSystemReport">
                                        <i class="fas fa-download"></i>
                                        Export Report
                                    </button>
                                </div>
                            </div>
                            
                            <!-- System Console - Landscape Layout -->
                            <div class="system-console">
                                <div class="console-header">
                                    <h3>
                                        <i class="fas fa-terminal"></i>
                                        System Output Console
                                    </h3>
                                    <button class="btn btn-secondary btn-sm" id="clearTerminalStatus">
                                        <i class="fas fa-trash"></i>
                                        Clear
                                    </button>
                                </div>
                                <div class="console-content" id="terminalOutputStatus">
                                    <div class="terminal-line">
                                        <span class="timestamp">[Starting]</span>
                                        <span class="message">System initialized and ready</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Active Scrapers Status -->
                        <div class="active-scrapers-panel">
                            <h3>Active Scrapers</h3>
                            <div class="active-scrapers-list" id="activeScrapersList">
                                <div class="empty-state">
                                    <i class="fas fa-robot"></i>
                                    <p>No active scrapers</p>
                                    <p class="help-text">Start a scraper from the dealership grid above to see real-time progress</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Order Queue Management Tab -->
                    <div class="tab-panel" id="queue-management-panel">
                        <div class="panel-header">
                            <h2>Order Queue Management</h2>
                            <div class="control-buttons">
                                <button class="btn btn-secondary" id="clearQueueBtn">
                                    <i class="fas fa-trash"></i>
                                    Clear Queue
                                </button>
                                <button class="btn btn-primary" id="refreshQueueBtn">
                                    <i class="fas fa-sync"></i>
                                    Refresh
                                </button>
                            </div>
                        </div>
                        
                        <div class="queue-layout">
                            <!-- Left Panel - Selection Interface -->
                            <div class="selection-panel">
                                <!-- Day Buttons -->
                                <div class="day-selection">
                                    <h3>Scheduled Days</h3>
                                    <div class="day-buttons">
                                        <button class="day-btn" data-day="monday">
                                            <i class="fas fa-calendar-day"></i>
                                            Monday
                                        </button>
                                        <button class="day-btn" data-day="tuesday">
                                            <i class="fas fa-calendar-day"></i>
                                            Tuesday
                                        </button>
                                        <button class="day-btn" data-day="wednesday">
                                            <i class="fas fa-calendar-day"></i>
                                            Wednesday
                                        </button>
                                        <button class="day-btn" data-day="thursday">
                                            <i class="fas fa-calendar-day"></i>
                                            Thursday
                                        </button>
                                        <button class="day-btn" data-day="friday">
                                            <i class="fas fa-calendar-day"></i>
                                            Friday
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- CSV Import Section -->
                                <div class="csv-import-section">
                                    <h3>
                                        <i class="fas fa-file-csv"></i>
                                        CSV Import (Testing)
                                    </h3>
                                    <div class="import-description">
                                        <p>Import Scraper 18 CSV data to test Order Processing accuracy</p>
                                    </div>
                                    <div class="csv-upload-area" id="csvUploadArea">
                                        <div class="upload-dropzone" id="uploadDropzone">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                            <h4>Drop CSV file here or click to browse</h4>
                                            <p>Supports Scraper 18 CSV format</p>
                                            <input type="file" id="csvFileInput" accept=".csv" hidden>
                                            <button class="btn btn-primary" onclick="document.getElementById('csvFileInput').click()">
                                                <i class="fas fa-upload"></i>
                                                Choose File
                                            </button>
                                        </div>
                                        <div class="csv-info" id="csvInfo" style="display: none;">
                                            <div class="file-details">
                                                <h4 id="fileName"></h4>
                                                <p id="fileDetails"></p>
                                            </div>
                                            <div class="csv-config">
                                                <label for="csvDealershipSelect">Select Dealership:</label>
                                                <select id="csvDealershipSelect" class="form-control">
                                                    <option value="">Choose dealership...</option>
                                                </select>
                                                <label for="csvOrderType">Order Type:</label>
                                                <select id="csvOrderType" class="form-control">
                                                    <option value="cao">CAO (Compare against VIN history)</option>
                                                    <option value="list">LIST (Process all vehicles)</option>
                                                </select>
                                                <div class="csv-test-options">
                                                    <label>
                                                        <input type="checkbox" id="keepDataForWizard"> 
                                                        Keep data in database for Order Processing Wizard testing
                                                    </label>
                                                    <small class="help-text">Check this to test the imported data in the main Order Processing Wizard after import</small>
                                                </div>
                                            </div>
                                            <div class="csv-actions">
                                                <button class="btn btn-success" id="processCSVBtn" disabled>
                                                    <i class="fas fa-cogs"></i>
                                                    Process CSV Order
                                                </button>
                                                <button class="btn btn-secondary" id="clearCSVBtn">
                                                    <i class="fas fa-times"></i>
                                                    Clear
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Individual Dealerships -->
                                <div class="dealership-selection">
                                    <h3>Individual Dealerships</h3>
                                    <div class="dealership-list" id="dealershipList">
                                        <!-- Will be populated dynamically -->
                                        <div class="loading">Loading dealerships...</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Right Panel - Processing Queue -->
                            <div class="queue-panel">
                                <h3>Processing Queue</h3>
                                <div class="queue-items" id="queueItems">
                                    <div class="empty-queue">
                                        <i class="fas fa-clipboard-list"></i>
                                        <p>No dealerships in queue</p>
                                        <p class="help-text">Select dealerships or day buttons to add to queue</p>
                                    </div>
                                </div>
                                
                                <div class="queue-actions">
                                    <button class="btn btn-primary btn-large" id="processQueueBtn" disabled>
                                        <i class="fas fa-play"></i>
                                        Process Queue
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="app-footer">
            <div class="footer-content">
                <img src="{{ url_for('static', filename='images/Asset_67.svg') }}" alt="Silver Fox Asset" class="footer-logo">
            </div>
        </footer>
    </div>

    <!-- Modals -->
    <!-- Dealership Settings Modal -->
    <div class="modal" id="dealershipModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Dealership Settings</h3>
                <button class="modal-close" id="closeModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="dealershipForm">
                    <div class="form-group">
                        <label>Vehicle Types to Include:</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="vehicle_types" value="new" checked>
                                <span class="checkmark"></span>
                                New Vehicles
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="vehicle_types" value="po" checked>
                                <span class="checkmark"></span>
                                Pre-Owned Vehicles
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="vehicle_types" value="cpo" checked>
                                <span class="checkmark"></span>
                                Certified Pre-Owned
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="minPrice">Minimum Price:</label>
                        <input type="number" id="minPrice" name="min_price" min="0" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="maxPrice">Maximum Price:</label>
                        <input type="number" id="maxPrice" name="max_price" min="0" placeholder="No limit">
                    </div>
                    <div class="form-group">
                        <label for="minYear">Minimum Year:</label>
                        <input type="number" id="minYear" name="min_year" min="1900" max="2030" placeholder="Any year">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelSettings">Cancel</button>
                <button class="btn btn-primary" id="saveSettings">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Vehicle History Modal -->
    <div class="modal" id="vehicleHistoryModal">
        <div class="modal-content vehicle-history-modal">
            <div class="modal-header">
                <h3 id="vehicleHistoryTitle">Vehicle History</h3>
                <button class="modal-close" id="closeVehicleHistoryModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Vehicle Summary Section -->
                <div class="vehicle-summary" id="vehicleSummary">
                    <div class="vehicle-info">
                        <div class="info-group">
                            <label>VIN:</label>
                            <span id="modalVin" class="vin-display">-</span>
                        </div>
                        <div class="info-group">
                            <label>Vehicle:</label>
                            <span id="modalVehicle">-</span>
                        </div>
                        <div class="info-group">
                            <label>Total Scrapes:</label>
                            <span id="modalTotalScrapes" class="scrape-badge">-</span>
                        </div>
                        <div class="info-group">
                            <label>Current Location:</label>
                            <span id="modalCurrentLocation">-</span>
                        </div>
                    </div>
                </div>
                
                <!-- History Timeline -->
                <div class="history-section">
                    <h4>Complete Vehicle History</h4>
                    <div class="history-timeline" id="historyTimeline">
                        <div class="loading-spinner">
                            <i class="fas fa-spinner fa-spin"></i>
                            Loading vehicle history...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Schedule Modal -->
    <div class="modal" id="scheduleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Scraper Schedule</h3>
                <button class="modal-close" id="closeScheduleModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="scheduleForm">
                    <div class="form-group">
                        <label for="scheduleTime">Daily Scrape Time:</label>
                        <input type="time" id="scheduleTime" name="schedule_time" value="02:00">
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="enableSchedule" name="enable_schedule">
                            <span class="checkmark"></span>
                            Enable Automatic Scheduling
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelSchedule">Cancel</button>
                <button class="btn btn-primary" id="saveSchedule">Save Schedule</button>
            </div>
        </div>
    </div>

    <!-- Dealership Selection Modal -->
    <div class="modal" id="dealershipSelectionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Select Dealerships to Scrape</h3>
                <button class="modal-close" id="closeDealershipSelectionModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="selection-actions">
                    <button class="btn btn-secondary btn-sm" id="selectAllBtnModal">Select All</button>
                    <button class="btn btn-secondary btn-sm" id="selectNoneBtnModal">Select None</button>
                </div>
                <div class="dealership-checkbox-grid" id="dealershipCheckboxGridModal">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDealershipSelection">Cancel</button>
                <button class="btn btn-primary" id="saveDealershipSelection">Start Selected Scrapers</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dealership-settings.js') }}"></script>
    <script src="{{ url_for('static', filename='js/csv-import.js') }}"></script>
</body>
</html>