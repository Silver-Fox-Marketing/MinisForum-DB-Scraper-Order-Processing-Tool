apiVersion: v1
kind: Service
metadata:
  name: silverfox-coordinator-service
  namespace: silverfox-scrapers
  labels:
    app: silverfox-scraper-system
    component: coordinator
spec:
  selector:
    app: silverfox-scraper-coordinator
    component: coordinator
  ports:
  - port: 8080
    targetPort: 8080
    protocol: TCP
    name: http
  - port: 9090
    targetPort: 9090
    protocol: TCP
    name: metrics
  type: ClusterIP

---
apiVersion: v1
kind: Service
metadata:
  name: silverfox-workers-service
  namespace: silverfox-scrapers
  labels:
    app: silverfox-scraper-system
    component: worker
spec:
  selector:
    app: silverfox-scraper-workers
    component: worker
  ports:
  - port: 9091
    targetPort: 9091
    protocol: TCP
    name: metrics
  type: ClusterIP

---
apiVersion: v1
kind: Service
metadata:
  name: silverfox-analytics-service
  namespace: silverfox-scrapers
  labels:
    app: silverfox-scraper-system
    component: analytics
spec:
  selector:
    app: silverfox-analytics-processor
    component: analytics
  ports:
  - port: 9092
    targetPort: 9092
    protocol: TCP
    name: metrics
  type: ClusterIP

---
# External LoadBalancer Service for Web Dashboard (if needed)
apiVersion: v1
kind: Service
metadata:
  name: silverfox-external-service
  namespace: silverfox-scrapers
  labels:
    app: silverfox-scraper-system
    component: external-access
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"  # For AWS
    service.beta.kubernetes.io/aws-load-balancer-scheme: "internet-facing"
spec:
  selector:
    app: silverfox-scraper-coordinator
    component: coordinator
  ports:
  - port: 80
    targetPort: 8080
    protocol: TCP
    name: http
  - port: 443
    targetPort: 8080
    protocol: TCP
    name: https
  type: LoadBalancer
  loadBalancerSourceRanges:
  - 10.0.0.0/8      # Internal network access only
  - 172.16.0.0/12   # Adjust based on your security requirements
  - 192.168.0.0/16

---
# Headless Service for StatefulSet (if using StatefulSet for workers)
apiVersion: v1
kind: Service
metadata:
  name: silverfox-workers-headless
  namespace: silverfox-scrapers
  labels:
    app: silverfox-scraper-system
    component: worker-headless
spec:
  selector:
    app: silverfox-scraper-workers
    component: worker
  ports:
  - port: 9091
    targetPort: 9091
    protocol: TCP
    name: metrics
  clusterIP: None
  type: ClusterIP

---
# Service Monitor for Prometheus (if using Prometheus Operator)
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: silverfox-scraper-metrics
  namespace: silverfox-scrapers
  labels:
    app: silverfox-scraper-system
    component: monitoring
spec:
  selector:
    matchLabels:
      app: silverfox-scraper-system
  endpoints:
  - port: metrics
    interval: 30s
    path: /metrics
    scrapeTimeout: 10s
  namespaceSelector:
    matchNames:
    - silverfox-scrapers